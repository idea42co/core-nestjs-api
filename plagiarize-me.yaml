replace:
  strings:
    author: ryan@idea42.co
    company: Idea42
    project_name: core-nestjs-api
    description: Core NestJS API

  vars:
    db-type: sqlite

  files:
    - src/shared/decorators/protected-method.decorator.ts
    - src/shared/decorators/rest-api.decorator.ts
    - src/shared/enums/authz/authz-action.enum.ts
    - src/shared/enums/authz/authz-scope.enum.ts
    - src/shared/interceptors/correlation-id.interceptor.ts
    - src/shared/interceptors/user.interceptor.ts
    - src/shared/interfaces/authz/authz-scope.interface.ts
    - src/shared/models/responses/rest.response.ts
    - src/shared/utilities/crypto.util.ts
    - src/shared/utilities/scope.util.ts
    - src/main.ts
    - src/ormconfig.ts
    - src/root.ts
    - test/app.e2e-spec.ts
    - test/jest-e2e.json
    - .eslintrc.js
    - .gitignore
    - .prettierrc
    - nest-cli.json
    - README.md
    - tsconfig.build.json
    - tsconfig.json
    - yarn.lock

create:
  files:
    - src/controllers/authentication/authentication.controller.ts
    - src/controllers/authentication/authentication.module.ts
    - src/controllers/authentication/authentication.service.ts
    - src/controllers/authentication/authentication-request.dto.ts
    - src/controllers/user/user.controller.ts
    - src/controllers/user/user.module.ts
    - src/controllers/user/user.service.ts
    - src/controllers/user/user-register-request.dto.ts
    - src/migrations/.gitkeep
    - src/shared/interfaces/config/database-config.interface.ts
    - src/shared/interfaces/config/jwt-config.interface.ts
    - src/shared/models/database/base.entity.ts
    - src/shared/models/database/scope.entity.ts
    - src/shared/models/database/user.entity.ts
    - src/shared/app.config.ts
    - src/shared/app.imports.ts
    - src/shared/app.providers.ts
    - src/app.module.ts
    - package.json

move:
  directories: []
  files: []

run:
  - command: yarn
    when: always
  - command: yarn build
    when: always

merge:
  - type: jq
    path: package.json
    create:
      - ".version"
      - ".license"
    replace:
      - ".name"
      - ".description"
      - ".author"
      - ".scripts.prebuild"
      - ".scripts.build"
      - ".scripts.format"
      - ".scripts.start"
      - ".scripts[\"start:dev\"]"
      - ".scripts[\"start:debug\"]"
      - ".scripts[\"start:prod\"]"
      - ".scripts.lint"
      - ".scripts.user"
      - ".scripts[\"user:watch\"]"
      - ".scripts[\"user:cov\"]"
      - ".scripts[\"user:debug\"]"
      - ".scripts[\"user:e2e\"]"
      - ".scripts.typeorm"
      - ".scripts[\"migration:generate\"]"
      - ".scripts[\"migration:run\"]"
      - ".dependencies[\"@nestjs/common\"]"
      - ".dependencies[\"@nestjs/config\"]"
      - ".dependencies[\"@nestjs/core\"]"
      - ".dependencies[\"@nestjs/platform-express\"]"
      - ".dependencies[\"@nestjs/swagger\"]"
      - ".dependencies[\"@nestjs/typeorm\"]"
      - ".dependencies[\"@types/jsonwebtoken\"]"
      - ".dependencies[\"class-transformer\"]"
      - ".dependencies[\"joi\"]"
      - ".dependencies[\"jsonwebtoken\"]"
      - ".dependencies[\"jwt-decode\"]"
      - ".dependencies[\"mssql\"]"
      - ".dependencies[\"mysql\"]"
      - ".dependencies[\"reflect-metadata\"]"
      - ".dependencies[\"rimraf\"]"
      - ".dependencies[\"rxjs\"]"
      - ".dependencies[\"sqlite3\"]"
      - ".dependencies[\"swagger-ui-express\"]"
      - ".dependencies[\"typeorm\"]"
      - ".devDependencies[\"@nestjs/cli\"]"
      - ".devDependencies[\"@nestjs/schematics\"]"
      - ".devDependencies[\"@nestjs/testing\"]"
      - ".devDependencies[\"@types/express\"]"
      - ".devDependencies[\"@types/jest\"]"
      - ".devDependencies[\"@types/node\"]"
      - ".devDependencies[\"@types/supertest\"]"
      - ".devDependencies[\"@typescript-eslint/eslint-plugin\"]"
      - ".devDependencies[\"@typescript-eslint/parser\"]"
      - ".devDependencies[\"eslint\"]"
      - ".devDependencies[\"eslint-config-prettier\"]"
      - ".devDependencies[\"eslint-plugin-prettier\"]"
      - ".devDependencies[\"jest\"]"
      - ".devDependencies[\"npm-run-all\"]"
      - ".devDependencies[\"prettier\"]"
      - ".devDependencies[\"supertest\"]"
      - ".devDependencies[\"ts-jest\"]"
      - ".devDependencies[\"ts-loader\"]"
      - ".devDependencies[\"ts-node\"]"
      - ".devDependencies[\"tsconfig-paths\"]"
      - ".devDependencies[\"typescript\"]"

templates:
  - name: environment
    replace:
      strings:
        env-name: localhost
        env-group: localhost
      vars:
        db_syncronize: true

    merge:
      - type: env
        path: src/env/localhost.env
        set:
          "*": "*"
          JWT_SECRET: $uuidv4()
          DB_TYPE: $db-type
          DB_SYNCRONIZE: $db_syncronize
          SQLITE_DB_NAME: core-nestjs-api.localhost.sqlite
          MYSQL_DB_NAME:  core-nestjs-api
          MSSQL_DB_NAME:  core-nestjs-api
    create:
      - JWT_SECRET
      - DB_SYNCRONIZE
      - DB_TYPE
      - MYSQL_DB_HOST
      - MYSQL_DB_PORT
      - MYSQL_DB_USERNAME
      - MYSQL_DB_PASSWORD
      - MYSQL_RO_DB_HOST
      - MYSQL_RO_DB_PORT
      - MSSQL_DB_HOST
      - MSSQL_DB_PORT
      - MSSQL_DB_NAME
      - MSSQL_DB_USERNAME
      - MSSQL_DB_PASSWORD

    configs:
      - strings:
          env-name: production
          env-group: production
        vars:
          db_syncronize: false

      - strings:
          env-name: development
          env-group: development
          vars:
            db_syncronize: false


